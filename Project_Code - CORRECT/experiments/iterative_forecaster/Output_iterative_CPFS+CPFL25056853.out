/zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/experiments/iterative_forecaster

Experiment directories created under: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL

Model Configuration:
  hidden_size: 24
  dropout: 0.25
  batch_size: 7392
  epochs: 100
  patience: 15
  learning_rate: 0.001
  week_steps: 672
  warmup_length: 672
  threshold: 13.0
  window_size: 100
  quick_mode: False
  objective_function: mae_loss
  use_time_features: False
  use_cumulative_features: True

Initializing trainer...

üñ•Ô∏è  Device Information:
   Using device: cpu
   CUDA not available, using CPU
==================================================
Using features: ['vst_raw_feature', 'temperature', 'rainfall']

Loading data for station 21006846...

Loading data for station 21006846...

Input Features Summary:
----------------------
Using features from:
  - Primary station:
    * vst_raw_feature
    * temperature
    * rainfall

Feature engineering settings:
  - Using time features: False
  - Using cumulative features: True
  - Using lagged features: False
----------------------


Handling NaN values:
  - Temperature: Forward fill, backward fill, then 30-day aggregation
  - Rainfall: Fill NaN with -1
  - vst_raw_feature: Fill NaN with -1
  - Target (vst_raw): Keep NaN values (handled in loss calculation)

Adding cumulative features...
  - Added cumulative rainfall features

All available feature columns (11): ['vst_raw_feature', 'temperature', 'rainfall', 'station_46_rain_1hour', 'station_46_rain_7hour', 'station_46_rain_48hour', 'station_46_rain_90hour', 'station_46_rain_1month', 'station_46_rain_3months', 'station_46_rain_6months', 'station_46_rain_1year']
Initializing model with input size: 11

Features in the model: Index(['vst_raw_feature', 'temperature', 'rainfall', 'vst_raw',
       'station_46_rain_1hour', 'station_46_rain_7hour',
       'station_46_rain_48hour', 'station_46_rain_90hour',
       'station_46_rain_1month', 'station_46_rain_3months',
       'station_46_rain_6months', 'station_46_rain_1year'],
      dtype='object')

Total features after engineering: 12

NaN values in data splits (after handling):
----------------------------------------

Training data:
  vst_raw: 73463 NaN values (17.85%)

Validation data:
  vst_raw: 5 NaN values (0.01%)

Test data:

Split Summary:
Training period: 2010 - 2021
Validation period: 2022 - 2023
Test year: 2024

Data shapes:
Total data: (517240, 12)
Train data: (411488, 12)
Validation data: (70078, 12)
Test data: (35136, 12)

No synthetic errors injected.

Training model...

Preparing training and validation data...

Preparing sequences:
Input DataFrame shape: (411488, 12)
Using all available features: 11 features
Features: ['vst_raw_feature', 'temperature', 'rainfall', 'station_46_rain_1hour', 'station_46_rain_7hour', 'station_46_rain_48hour', 'station_46_rain_90hour', 'station_46_rain_1month', 'station_46_rain_3months', 'station_46_rain_6months', 'station_46_rain_1year']
Features DataFrame shape: (411488, 11)
Target DataFrame shape: (411488, 1)
Fitted scalers on 338025 valid target points
Scaled features shape: (411488, 11)

NaN values in final tensors:
--------------------------
Target: 73463 NaN values (17.85%)
Prepared tensors - x_shape: torch.Size([1, 411488, 11]), y_shape: torch.Size([1, 411488, 1])

Preparing sequences:
Input DataFrame shape: (70078, 12)
Using all available features: 11 features
Features: ['vst_raw_feature', 'temperature', 'rainfall', 'station_46_rain_1hour', 'station_46_rain_7hour', 'station_46_rain_48hour', 'station_46_rain_90hour', 'station_46_rain_1month', 'station_46_rain_3months', 'station_46_rain_6months', 'station_46_rain_1year']
Features DataFrame shape: (70078, 11)
Target DataFrame shape: (70078, 1)
Scaled features shape: (70078, 11)

NaN values in final tensors:
--------------------------
Target: 5 NaN values (0.01%)
Prepared tensors - x_shape: torch.Size([1, 70078, 11]), y_shape: torch.Size([1, 70078, 1])

Training data shapes:
x_train: torch.Size([1, 411488, 11])
y_train: torch.Size([1, 411488, 1])
x_val: torch.Size([1, 70078, 11])
y_val: torch.Size([1, 70078, 1])

Training configuration:
Total samples: 411488
Batch size: 7392
Number of batches per epoch: 56

Epoch 1/100 - Train Loss: 0.778445, Val Loss: 0.649277
New best validation loss: inf

Epoch 2/100 - Train Loss: 0.650851, Val Loss: 0.521036
New best validation loss: 0.649277

Epoch 3/100 - Train Loss: 0.566655, Val Loss: 0.465248
New best validation loss: 0.521036

Epoch 4/100 - Train Loss: 0.529737, Val Loss: 0.416659
New best validation loss: 0.465248

Epoch 5/100 - Train Loss: 0.508768, Val Loss: 0.382629
New best validation loss: 0.416659

Epoch 6/100 - Train Loss: 0.480120, Val Loss: 0.333591
New best validation loss: 0.382629

Epoch 7/100 - Train Loss: 0.446823, Val Loss: 0.302803
New best validation loss: 0.333591

Epoch 8/100 - Train Loss: 0.425091, Val Loss: 0.258374
New best validation loss: 0.302803

Epoch 9/100 - Train Loss: 0.410799, Val Loss: 0.245699
New best validation loss: 0.258374

Epoch 10/100 - Train Loss: 0.416836, Val Loss: 0.225040
New best validation loss: 0.245699

Epoch 11/100 - Train Loss: 0.393304, Val Loss: 0.216744
New best validation loss: 0.225040

Epoch 12/100 - Train Loss: 0.390583, Val Loss: 0.198411
New best validation loss: 0.216744

Epoch 13/100 - Train Loss: 0.385895, Val Loss: 0.188259
New best validation loss: 0.198411

Epoch 14/100 - Train Loss: 0.369323, Val Loss: 0.192415
Patience: 1/15

Epoch 15/100 - Train Loss: 0.374744, Val Loss: 0.174401
New best validation loss: 0.188259

Epoch 16/100 - Train Loss: 0.359037, Val Loss: 0.170084
New best validation loss: 0.174401

Epoch 17/100 - Train Loss: 0.355457, Val Loss: 0.168371
New best validation loss: 0.170084

Epoch 18/100 - Train Loss: 0.354335, Val Loss: 0.145913
New best validation loss: 0.168371

Epoch 19/100 - Train Loss: 0.345814, Val Loss: 0.157497
Patience: 1/15

Epoch 20/100 - Train Loss: 0.347320, Val Loss: 0.153530
Patience: 2/15

Epoch 21/100 - Train Loss: 0.354227, Val Loss: 0.159980
Patience: 3/15

Epoch 22/100 - Train Loss: 0.340863, Val Loss: 0.143731
New best validation loss: 0.145913

Epoch 23/100 - Train Loss: 0.338515, Val Loss: 0.142276
New best validation loss: 0.143731

Epoch 24/100 - Train Loss: 0.339322, Val Loss: 0.143939
Patience: 1/15

Epoch 25/100 - Train Loss: 0.334305, Val Loss: 0.150138
Patience: 2/15

Epoch 26/100 - Train Loss: 0.336536, Val Loss: 0.121693
New best validation loss: 0.142276

Epoch 27/100 - Train Loss: 0.332646, Val Loss: 0.138852
Patience: 1/15

Epoch 28/100 - Train Loss: 0.331641, Val Loss: 0.129030
Patience: 2/15

Epoch 29/100 - Train Loss: 0.344962, Val Loss: 0.144361
Patience: 3/15

Epoch 30/100 - Train Loss: 0.332874, Val Loss: 0.136774
Patience: 4/15

Epoch 31/100 - Train Loss: 0.330393, Val Loss: 0.133170
Patience: 5/15

Epoch 32/100 - Train Loss: 0.339115, Val Loss: 0.124160
Patience: 6/15

Epoch 33/100 - Train Loss: 0.322799, Val Loss: 0.125420
Patience: 7/15

Epoch 34/100 - Train Loss: 0.323215, Val Loss: 0.122736
Patience: 8/15

Epoch 35/100 - Train Loss: 0.320061, Val Loss: 0.110216
New best validation loss: 0.121693

Epoch 36/100 - Train Loss: 0.326890, Val Loss: 0.150908
Patience: 1/15

Epoch 37/100 - Train Loss: 0.330558, Val Loss: 0.134287
Patience: 2/15

Epoch 38/100 - Train Loss: 0.324712, Val Loss: 0.109405
New best validation loss: 0.110216

Epoch 39/100 - Train Loss: 0.326499, Val Loss: 0.121552
Patience: 1/15

Epoch 40/100 - Train Loss: 0.309847, Val Loss: 0.119461
Patience: 2/15

Epoch 41/100 - Train Loss: 0.328498, Val Loss: 0.116758
Patience: 3/15

Epoch 42/100 - Train Loss: 0.317634, Val Loss: 0.125519
Patience: 4/15

Epoch 43/100 - Train Loss: 0.316455, Val Loss: 0.134216
Patience: 5/15

Epoch 44/100 - Train Loss: 0.323452, Val Loss: 0.100030
New best validation loss: 0.109405

Epoch 45/100 - Train Loss: 0.313914, Val Loss: 0.106387
Patience: 1/15

Epoch 46/100 - Train Loss: 0.313971, Val Loss: 0.140836
Patience: 2/15

Epoch 47/100 - Train Loss: 0.313064, Val Loss: 0.107831
Patience: 3/15

Epoch 48/100 - Train Loss: 0.324391, Val Loss: 0.122960
Patience: 4/15

Epoch 49/100 - Train Loss: 0.311283, Val Loss: 0.105782
Patience: 5/15

Epoch 50/100 - Train Loss: 0.305810, Val Loss: 0.125102
Patience: 6/15

Epoch 51/100 - Train Loss: 0.323290, Val Loss: 0.125541
Patience: 7/15

Epoch 52/100 - Train Loss: 0.310896, Val Loss: 0.141502
Patience: 8/15

Epoch 53/100 - Train Loss: 0.306264, Val Loss: 0.098973
New best validation loss: 0.100030

Epoch 54/100 - Train Loss: 0.323564, Val Loss: 0.108533
Patience: 1/15

Epoch 55/100 - Train Loss: 0.303400, Val Loss: 0.119811
Patience: 2/15

Epoch 56/100 - Train Loss: 0.310879, Val Loss: 0.113555
Patience: 3/15

Epoch 57/100 - Train Loss: 0.311007, Val Loss: 0.111924
Patience: 4/15

Epoch 58/100 - Train Loss: 0.297250, Val Loss: 0.109070
Patience: 5/15

Epoch 59/100 - Train Loss: 0.307702, Val Loss: 0.118745
Patience: 6/15

Epoch 60/100 - Train Loss: 0.303178, Val Loss: 0.099608
Patience: 7/15

Epoch 61/100 - Train Loss: 0.315694, Val Loss: 0.118337
Patience: 8/15

Epoch 62/100 - Train Loss: 0.298384, Val Loss: 0.122287
Patience: 9/15

Epoch 63/100 - Train Loss: 0.301352, Val Loss: 0.114162
Patience: 10/15

Epoch 64/100 - Train Loss: 0.298387, Val Loss: 0.104360
Patience: 11/15

Epoch 65/100 - Train Loss: 0.289041, Val Loss: 0.105318
Patience: 12/15

Epoch 66/100 - Train Loss: 0.289967, Val Loss: 0.109628
Patience: 13/15

Epoch 67/100 - Train Loss: 0.294981, Val Loss: 0.099564
Patience: 14/15

Epoch 68/100 - Train Loss: 0.282570, Val Loss: 0.103402
Patience: 15/15
Early stopping at epoch 68

Skipping test predictions, focusing on validation results only...

Converting predictions back to original scale...
Predictions shape: (70078,)
Min prediction value: 328.33355712890625
Max prediction value: 1259.028076171875

Generating visualizations...
All plots will be saved to experiment directory: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL
Saved convergence plot to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/visualizations/convergence_plot_21006846.png
Length of test_actual: 70078
Length of predictions: 70078
Saved water level PNG plot to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/visualizations/water_level_station_21006846_20250525_020002.png
VINGE data is None for station 21006846
Opening plot in browser: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/visualizations/predictions_station_21006846_20250525_020002.html

Calculating anomalies...
Number of anomalies detected: 79

Validation Metrics (against original data):
  rmse: 38.904508
  mae: 20.991825
  nse: 0.972105

[2025-05-25 02:00:11] Generating diagnostic visualizations for station 21006846...
  - Creating individual residual plots...
Individual residual plots saved to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics/individual_residuals
  - Creating actual vs predicted plot...
Saved actual vs predicted plot to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics/actual_vs_predicted_21006846_20250525_020021.png
  - Creating error pattern heatmap...
Saved error heatmap to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics/error_heatmap_21006846_20250525_020023.png
  - Creating feature importance plot...
Warning: Data contains NaN or infinite values. Cleaning data for analysis.
Saved feature importance plot to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics/feature_importance_21006846_20250525_020025.png
  - Creating correlation analysis plots...
Saved correlation analysis plots to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics/correlation_analysis_21006846_20250525_020048.png and /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics/error_correlation_21006846_20250525_020048.png

All diagnostic visualizations saved to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics

============================================================
EXPERIMENT CPFS+CPFL COMPLETED SUCCESSFULLY!
============================================================
Results saved to: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL
  - Diagnostics: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/diagnostics
  - Anomaly Detection: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/anomaly_detection
  - Visualizations: /zhome/ff/b/147446/MasterThesis/Project_Code - CORRECT/results/Iterative model results/experiment_CPFS+CPFL/visualizations
============================================================
